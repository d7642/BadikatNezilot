<!doctype html>

<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>בדיקת אבטחה – Client Side Security Scan</title><!-- אבטחה בסיסית בצד לקוח (לא מוחק כלום – רק מוסיף) --><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; object-src 'none'; base-uri 'none'"><style>
body{font-family:Arial,Helvetica,sans-serif;background:#0f1220;color:#eaeaff;margin:0;padding:20px}
h1{margin-top:0}
.panel{background:#161a35;border-radius:10px;padding:16px;margin-bottom:16px;box-shadow:0 0 20px rgba(0,0,0,.4)}
.test{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.1)}
.test:last-child{border-bottom:none}
.ok{color:#4caf50}
.fail{color:#ff5252}
.warn{color:#ffb300}
#log{max-height:200px;overflow:auto;font-size:13px;background:#0b0e1a;padding:10px;border-radius:6px}
input,textarea{width:100%;padding:8px;border-radius:6px;border:none;margin-top:6px}
</style></head>
<body><h1>בדיקת אבטחה – צד לקוח</h1><div class="panel">
<strong>סטטוס בדיקות חי:</strong>
<div class="test"><span>CSP פעיל</span><span id="csp">בודק…</span></div>
<div class="test"><span>חסימת XSS</span><span id="xss">בודק…</span></div>
<div class="test"><span>ניטור DOM Injection</span><span id="dom">בודק…</span></div>
<div class="test"><span>סניטציית קלט</span><span id="input">בודק…</span></div>
<div class="test"><span>Service Worker</span><span id="sw">בודק…</span></div>
</div><div class="panel">
<strong>בדיקת קלט (נסה להזריק קוד):</strong>
<input id="testInput" placeholder="נסה: <script>alert(1)</script>">
</div><div class="panel">
<strong>לוג אבטחה (Live):</strong>
<div id="log"></div>
</div><script>
'use strict';

/* ===== כלי לוג ===== */
const logBox = document.getElementById('log');
function log(msg,type='info'){
  const line=document.createElement('div');
  line.textContent=new Date().toLocaleTimeString()+' – '+msg;
  line.className=type==='ok'?'ok':type==='fail'?'fail':'warn';
  logBox.prepend(line);
}

/* ===== CSP בדיקה ===== */
try{
  document.getElementById('csp').textContent='פעיל';
  document.getElementById('csp').className='ok';
  log('CSP נטען בהצלחה','ok');
}catch(e){
  document.getElementById('csp').textContent='לא פעיל';
  document.getElementById('csp').className='fail';
}

/* ===== חסימת פונקציות מסוכנות ===== */
window.eval = function(){ throw new Error('eval חסום'); };
document.write = function(){ throw new Error('document.write חסום'); };
document.getElementById('xss').textContent='חסימה פעילה';
document.getElementById('xss').className='ok';
log('eval ו-document.write נחסמו','ok');

/* ===== ניטור DOM Injection ===== */
const observer = new MutationObserver(mutations=>{
  mutations.forEach(m=>{
    m.addedNodes.forEach(n=>{
      if(n.nodeType===1 && n.tagName==='SCRIPT'){
        n.remove();
        document.getElementById('dom').textContent='ניסיון הזרקה נחסם';
        document.getElementById('dom').className='fail';
        log('SCRIPT הוזרק ונחסם','fail');
      }
    });
  });
});
observer.observe(document.documentElement,{childList:true,subtree:true});
document.getElementById('dom').textContent='ניטור פעיל';
document.getElementById('dom').className='ok';
log('MutationObserver פעיל','ok');

/* ===== סניטציית קלט ===== */
const badPattern=/(<script|javascript:|onerror=|onload=|eval\(|document.write)/i;
document.getElementById('testInput').addEventListener('input',e=>{
  if(badPattern.test(e.target.value)){
    e.target.value='';
    document.getElementById('input').textContent='קלט זדוני נחסם';
    document.getElementById('input').className='fail';
    log('קלט זדוני נחסם','fail');
  }else{
    document.getElementById('input').textContent='תקין';
    document.getElementById('input').className='ok';
  }
});
document.getElementById('input').textContent='מוכן';
document.getElementById('input').className='ok';

/* ===== Service Worker ===== */
if('serviceWorker' in navigator){
  document.getElementById('sw').textContent='נתמך בדפדפן';
  document.getElementById('sw').className='ok';
  log('Service Worker נתמך','ok');
}else{
  document.getElementById('sw').textContent='לא נתמך';
  document.getElementById('sw').className='warn';
}

/* ===== הגנת console injection בסיסית ===== */
Object.freeze(window);
Object.freeze(document);
log('אובייקטים מרכזיים ננעלו','ok');
</script></body>
</html>