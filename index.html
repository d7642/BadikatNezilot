<!doctype html>
<html lang="he" dir="rtl" data-theme="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="Client-Side Privacy & Security Scanner">
    <title>CyberScan Pro â€” Advanced Client-Side Audit</title>

    <style>
        /* --- Core Variables & Reset --- */
        :root {
            --bg: #060709; 
            --panel: #111418; 
            --text-main: #e6eef6; 
            --text-muted: #98a2ad;
            --accent: #d33b3b; 
            --accent-glow: rgba(211, 59, 59, 0.3);
            --accent2: #1f6feb; 
            --good: #2ea043; 
            --warn: #d29922; 
            --info: #1f6feb;
            --bad: #f85149;
            --glass: rgba(255, 255, 255, 0.03); 
            --border: rgba(255, 255, 255, 0.08); 
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            --font-stack: "Segoe UI", "Helvetica Neue", system-ui, sans-serif;
        }

        [data-theme="light"] {
            --bg: #f0f2f5; 
            --panel: #ffffff; 
            --text-main: #1c1e21; 
            --text-muted: #606770;
            --accent: #d93025; 
            --accent-glow: rgba(217, 48, 37, 0.2);
            --glass: rgba(0, 0, 0, 0.03); 
            --border: rgba(0, 0, 0, 0.1); 
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; outline: none; }
        html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text-main); font-family: var(--font-stack); scroll-behavior: smooth; transition: background 0.3s, color 0.3s; }
        
        /* --- Layout --- */
        .app { max-width: 950px; margin: 20px auto; padding: 15px; padding-bottom: 100px; }
        
        /* --- Header --- */
        header { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        .brand { display: flex; align-items: center; gap: 15px; }
        .logo { width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), #7b1515); display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 18px; color: white; box-shadow: 0 0 15px var(--accent-glow); }
        .brand h1 { margin: 0; font-size: 20px; letter-spacing: -0.5px; }
        .brand p { margin: 2px 0 0 0; font-size: 12px; color: var(--text-muted); }

        .controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        
        /* --- Buttons --- */
        .btn { background: var(--accent); border: 0; padding: 10px 20px; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; text-decoration: none; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .btn.secondary { background: var(--glass); border: 1px solid var(--border); color: var(--text-main); }
        .btn.secondary:hover { background: rgba(255,255,255,0.05); border-color: var(--text-muted); }
        
        .btn-icon { background: transparent; border: none; font-size: 20px; cursor: pointer; padding: 8px; border-radius: 50%; color: var(--text-main); }
        .btn-icon:hover { background: var(--glass); }

        /* --- Score Board --- */
        .score-box { display: flex; align-items: center; gap: 10px; background: var(--panel); padding: 5px 15px; border-radius: 50px; border: 1px solid var(--border); }
        #privacyScore { font-size: 22px; font-weight: 800; font-variant-numeric: tabular-nums; }
        
        /* --- Disclaimer Box --- */
        .disclaimer-card {
            background: rgba(31, 111, 235, 0.08);
            border-right: 4px solid var(--accent2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 13px;
            line-height: 1.6;
        }
        .disclaimer-card strong { color: var(--accent2); display: block; margin-bottom: 5px; font-size: 14px; }
        .disclaimer-card ul { margin: 5px 0 0 0; padding-right: 20px; color: var(--text-muted); }

        /* --- Result Cards --- */
        .results-grid { display: flex; flex-direction: column; gap: 15px; }
        
        .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 0; box-shadow: var(--shadow); transition: border-color 0.3s; position: relative; overflow: hidden; }
        .card:hover { border-color: rgba(255,255,255,0.15); }
        .card.dragging { opacity: 0.5; border: 2px dashed var(--accent); }

        .card-header { padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; user-select: none; background: rgba(255,255,255,0.01); }
        .card-header:hover { background: rgba(255,255,255,0.03); }
        
        .card-title { font-weight: 700; font-size: 15px; display: flex; align-items: center; gap: 10px; }
        .card-desc { font-size: 12px; color: var(--text-muted); font-weight: 400; margin-right: 10px; }
        
        .chev { transition: transform 0.3s ease; color: var(--text-muted); }
        .expanded .chev { transform: rotate(180deg); }

        .card-body { max-height: 0; overflow: hidden; transition: max-height 0.4s cubic-bezier(0, 1, 0, 1); opacity: 0.5; }
        .expanded .card-body { max-height: 5000px; opacity: 1; transition: max-height 0.5s ease-in-out; border-top: 1px solid var(--border); }
        
        /* --- List Items --- */
        .list-item { padding: 12px 20px; border-bottom: 1px dashed var(--border); font-size: 13px; display: flex; justify-content: space-between; align-items: center; }
        .list-item:last-child { border-bottom: none; }
        
        .badge { padding: 3px 8px; border-radius: 6px; font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge.good { background: rgba(46, 160, 67, 0.15); color: var(--good); }
        .badge.warn { background: rgba(210, 153, 34, 0.15); color: var(--warn); }
        .badge.bad { background: rgba(248, 81, 73, 0.15); color: var(--bad); }
        .badge.info { background: rgba(31, 111, 235, 0.15); color: var(--info); }

        .detail-row { background: rgba(0,0,0,0.2); padding: 10px 20px; font-size: 12px; color: var(--text-muted); border-bottom: 1px solid var(--border); display: none; }
        .list-item:hover + .detail-row, .detail-row:hover { display: block; }
        .detail-row strong { color: var(--text-main); }
        
        /* --- Logs --- */
        #liveLogs { background: #000; color: #2ea043; font-family: 'Consolas', monospace; font-size: 11px; height: 120px; overflow-y: auto; padding: 10px; border-radius: 8px; border: 1px solid var(--border); margin-top: 20px; }
        .log-line { border-bottom: 1px solid #111; padding: 2px 0; }
        .log-time { color: #555; margin-right: 8px; user-select: none; }

        /* --- Drag Handle --- */
        .drag-handle { cursor: grab; opacity: 0.3; padding: 5px; margin-left: 10px; }
        .drag-handle:active { cursor: grabbing; }

    </style>
</head>

<body>

    <div class="app">
        <header>
            <div class="brand">
                <div class="logo">CS</div>
                <div>
                    <h1>CyberScan Pro</h1>
                    <p>Advanced Client-Side Security Auditor</p>
                </div>
            </div>

            <div class="controls">
                <div class="score-box">
                    <span id="privacyScore">â€”</span>
                    <span style="font-size:11px; color:var(--text-muted)">×¦×™×•×Ÿ ××‘×˜×—×”</span>
                </div>
                <button class="btn-icon" id="themeToggle" title="×”×—×œ×£ ×¢×¨×›×ª × ×•×©×">ğŸŒ—</button>
            </div>

            <div style="width: 100%; display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px;">
                <div id="exportGroup" style="display:none; gap:10px;">
                    <button id="downloadHebBtn" class="btn secondary">ğŸ“„ ×“×•×— ××œ× (HTML)</button>
                    <button id="downloadJsonBtn" class="btn secondary">{ } ×“×•×— × ×ª×•× ×™× (JSON)</button>
                </div>

                <button id="startScanBtn" class="btn">
                    <span>ğŸ” ×”×ª×—×œ ×¡×¨×™×§×” ××œ××”</span>
                </button>
            </div>
        </header>

        <div class="disclaimer-card">
            <strong>âš ï¸ ×”×¦×”×¨×ª ×××™× ×•×ª (Client-Side Limitations)</strong>
            ×“×•×— ×–×” ××‘×•×¡×¡ ×¢×œ ×¡×¨×™×§×ª JavaScript ×‘×“×¤×“×¤×Ÿ ×”×œ×§×•×— ×‘×œ×‘×“.
            <ul>
                <li>×‘×“×™×§×•×ª ×©×¨×ª (Server-Side) ××™× ×Ÿ ××¤×©×¨×™×•×ª ××›××Ÿ (×›×’×•×Ÿ DB Injection, WAF, Server Version).</li>
                <li>×›×•×ª×¨×•×ª ××‘×˜×—×” ××¡×•×™××•×ª (HSTS, HttpOnly Cookies) ××™× ×Ÿ ×’×œ×•×™×•×ª ×œ-JavaScript ××˜×¢××™ ××‘×˜×—×”, ×•×œ×›×Ÿ ×™×¡×•×× ×• ×›-INFO.</li>
                <li>×”×“×•×— ××©×§×£ ××ª ××” ×©×”×“×¤×“×¤×Ÿ "×¨×•××”" ×‘×œ×‘×“.</li>
            </ul>
        </div>

        <div class="results-grid" id="resultsContainer">
            </div>

        <h4 style="margin: 20px 0 5px 0; font-size:13px; color:var(--text-muted); opacity:0.7;">System Logs</h4>
        <div id="liveLogs"></div>
    </div>

    <script>
        'use strict';

        // --- 1. Utility & Security Functions ---
        
        const $ = id => document.getElementById(id);
        
        // Critical for Security: Prevents XSS in the report
        function escapeHTML(str) {
            if (typeof str !== 'string') return str;
            return str.replace(/[&<>'"]/g, tag => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
            }[tag]));
        }

        function log(msg) {
            const container = $('liveLogs');
            const div = document.createElement('div');
            div.className = 'log-line';
            div.innerHTML = `<span class="log-time">[${new Date().toLocaleTimeString()}]</span> ${escapeHTML(msg)}`;
            container.prepend(div);
        }

        // --- 2. Data Definitions (The Checks) ---

        // Categories
        const GROUPS = {
            conn:   { title: 'ğŸ”’ ×—×™×‘×•×¨ ×•×”×¦×¤× ×”', desc: 'HTTPS, HSTS, Protocol' },
            script: { title: 'ğŸ’‰ ×”×’× ×” ××¤× ×™ ×”×–×¨×§×•×ª', desc: 'XSS, CSP, DOM Sinks' },
            fp:     { title: 'ğŸ•µï¸ ×¤×¨×˜×™×•×ª ×•××¢×§×‘', desc: 'Fingerprinting, Canvas, APIs' },
            storage:{ title: 'ğŸª ××—×¡×•×Ÿ ×•× ×ª×•× ×™×', desc: 'Cookies, LocalStorage, Cache' },
            api:    { title: 'ğŸŒ ×¨×©×ª ×•-APIs', desc: 'WebRTC, Referrer, Fetch' }
        };

        // The Checks Logic - Adjusted for REALITY (Info vs Warn)
        const CHECKS = [
            // --- Connection ---
            {
                id: 'https_status', group: 'conn', points: 20,
                title: '×¤×¨×•×˜×•×§×•×œ HTTPS',
                run: () => ({ val: location.protocol, status: location.protocol === 'https:' ? 'good' : 'bad' }),
                details: { info: '×¤×¨×•×˜×•×§×•×œ ×”×ª×§×©×•×¨×ª ×”× ×•×›×—×™.', fix: '×—×•×‘×” ×œ×”×©×ª××© ×‘×ª×¢×•×“×ª SSL ×ª×§×™× ×”.' }
            },
            {
                id: 'hsts_check', group: 'conn', points: 0, // 0 points because JS can't see it
                title: '××›×™×¤×ª HSTS',
                run: () => ({ val: 'Header Hidden from JS', status: 'info' }),
                details: { info: 'HSTS ××•× ×¢ ×©× ××•×š ×œ-HTTP. ×œ× × ×™×ª×Ÿ ×œ×•×•×“× ×‘×¦×“ ×œ×§×•×—.', fix: '×™×© ×œ×•×•×“× ×”×’×“×¨×” ×‘×©×¨×ª (Strict-Transport-Security).' }
            },

            // --- Script / XSS ---
            {
                id: 'csp_check', group: 'script', points: 15,
                title: '××“×™× ×™×•×ª CSP (×–×™×”×•×™ ×—×œ×§×™)',
                run: () => {
                    // JS can only see META tags, not headers
                    const metaCSP = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
                    return { val: metaCSP ? 'Meta Tag Found' : 'No Meta Tag', status: metaCSP ? 'good' : 'info' }; 
                },
                details: { info: 'CSP ××’×Ÿ ××¤× ×™ XSS. ×× ××•×’×“×¨ ×‘-Header, ×”-JS ×œ× ×™×¨××” ×–××ª.', fix: '××•××œ×¥ ×œ×”×’×“×™×¨ CSP ××—××™×¨ ×‘×©×¨×ª.' }
            },
            {
                id: 'xss_reflection', group: 'script', points: 10,
                title: '×”×–×¨×§×ª URL (Reflected)',
                run: () => {
                    const unsafe = location.href.includes('<') || location.href.includes('javascript:');
                    return { val: unsafe ? 'Suspicious URL' : 'Clean URL', status: unsafe ? 'bad' : 'good' };
                },
                details: { info: '×‘×“×™×§×” ×”×× ×”-URL ××›×™×œ ×ª×•×•×™× ××¡×•×›× ×™×.', fix: '×™×© ×œ×¡× ×Ÿ ×§×œ×˜ ×‘×©×¨×ª ×•×œ×§×•×“×“ ×¤×œ×˜.' }
            },
            {
                id: 'iframe_check', group: 'script', points: 5,
                title: 'Iframe Sandbox',
                run: () => ({ val: window.self !== window.top ? 'Inside Iframe' : 'Top Level', status: 'info' }),
                details: { info: '×”×× ×”××ª×¨ × ×˜×¢×Ÿ ×‘×ª×•×š Iframe.', fix: '×©×™××•×© ×‘-X-Frame-Options ×œ×× ×™×¢×ª Clickjacking.' }
            },

            // --- Privacy / FP ---
            {
                id: 'canvas_fp', group: 'fp', points: 5,
                title: '×–×™×”×•×™ Canvas (Fingerprinting)',
                run: () => ({ val: 'API ×–××™×Ÿ ×œ×©×™××•×©', status: 'warn' }),
                details: { info: '×”××ª×¨ ×™×›×•×œ ×œ×”×©×ª××© ×‘-Canvas ×œ×–×™×”×•×™ ×™×™×—×•×“×™ ×©×œ ×”××›×©×™×¨.', fix: '×–×• ×™×›×•×œ×ª ×“×¤×“×¤×Ÿ, ×œ× ×—×•×œ×©×ª ××‘×˜×—×”. ××©×¤×™×¢ ×¢×œ ×¤×¨×˜×™×•×ª.' }
            },
            {
                id: 'geo_perm', group: 'fp', points: 10,
                title: '×”×¨×©××ª ××™×§×•× (Geolocation)',
                run: async () => {
                    try {
                        const s = await navigator.permissions.query({name:'geolocation'});
                        return { val: s.state, status: s.state === 'granted' ? 'bad' : 'good' };
                    } catch(e) { return { val: 'Unknown', status: 'info' }; }
                },
                details: { info: '×”×× ×œ××ª×¨ ×™×© ×’×™×©×” ×œ××™×§×•× ×”×¤×™×–×™.', fix: '×™×© ×œ××¤×¡ ×”×¨×©××•×ª ×× ×”××ª×¨ ××™× ×• ×–×§×•×§ ×œ××™×§×•×.' }
            },

            // --- Storage ---
            {
                id: 'cookie_secure', group: 'storage', points: 0,
                title: '×¢×•×’×™×•×ª ×××•×‘×˜×—×•×ª',
                run: () => ({ val: 'JS Access Check', status: 'info' }),
                details: { info: '×¢×•×’×™×•×ª HttpOnly ××•×¡×ª×¨×•×ª ×-JS ×•×œ×›×Ÿ ×œ× × ×™×ª×Ÿ ×œ×‘×“×•×§ ×“×’×œ Secure ×‘×•×•×“××•×ª.', fix: '×™×© ×œ×•×•×“× ×“×’×œ×™ Secure; HttpOnly; SameSite ×‘×©×¨×ª.' }
            },
            {
                id: 'local_storage', group: 'storage', points: 5,
                title: '×©×™××•×© ×‘-LocalStorage',
                run: () => ({ val: `${localStorage.length} ×¤×¨×™×˜×™×`, status: localStorage.length > 5 ? 'warn' : 'good' }),
                details: { info: '××™×“×¢ ×©× ×©××¨ ××§×•××™×ª ×‘×“×¤×“×¤×Ÿ.', fix: '××™×Ÿ ×œ×©××•×¨ ××™×“×¢ ×¨×’×™×© (Token, PII) ×‘-LocalStorage.' }
            },

            // --- API / Network ---
            {
                id: 'referrer_policy', group: 'api', points: 5,
                title: '××“×™× ×™×•×ª Referrer',
                run: () => ({ val: document.referrerPolicy || 'Default', status: document.referrerPolicy ? 'good' : 'warn' }),
                details: { info: '×©×•×œ×˜ ×‘××™×“×¢ ×©× ×©×œ×— ×œ××ª×¨×™× ××—×¨×™× ×‘×¢×ª ×œ×—×™×¦×” ×¢×œ ×§×™×©×•×¨.', fix: '××•××œ×¥: strict-origin-when-cross-origin.' }
            }
        ];

        let lastScanReport = null;

        // --- 3. UI Generation Functions ---

        function initUI() {
            const container = $('resultsContainer');
            container.innerHTML = '';
            
            // Generate cards for each group
            for (const [key, group] of Object.entries(GROUPS)) {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${key}`;
                card.setAttribute('draggable', true); // Drag & Drop support
                
                card.innerHTML = `
                    <div class="card-header" onclick="toggleCard(this)">
                        <div class="card-title">
                            <span class="drag-handle">::</span>
                            ${group.title}
                        </div>
                        <div style="display:flex; align-items:center;">
                            <span class="card-desc">${group.desc}</span>
                            <span class="chev">â–¼</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="list-wrapper" id="list-${key}"></div>
                    </div>
                `;
                container.appendChild(card);
            }
            
            setupDragAndDrop();
        }

        function toggleCard(header) {
            header.parentElement.classList.toggle('expanded');
        }

        // --- 4. Scanning Logic ---

        async function runScan() {
            log('Starting full system scan...');
            const btn = $('startScanBtn');
            btn.disabled = true;
            btn.innerHTML = 'â³ ×¡×•×¨×§...';

            let score = 100;
            const items = [];
            
            // Reset UI
            document.querySelectorAll('.list-wrapper').forEach(el => el.innerHTML = '');

            // Run Checks
            for (const check of CHECKS) {
                try {
                    const result = await check.run();
                    
                    // Score calculation (only deduct for confirmed bad findings)
                    if (result.status === 'bad') score -= check.points;
                    if (result.status === 'warn') score -= (check.points / 2);

                    const itemData = {
                        ...check,
                        result: result
                    };
                    items.push(itemData);

                    // Render to UI
                    renderResultItem(itemData);
                    
                } catch (e) {
                    console.error(e);
                    log(`Error running ${check.id}`);
                }
            }

            score = Math.max(0, Math.round(score));
            
            // Update Score UI
            const scoreEl = $('privacyScore');
            scoreEl.textContent = score;
            scoreEl.style.color = score > 80 ? 'var(--good)' : (score > 50 ? 'var(--warn)' : 'var(--bad)');

            // Save Data for Export
            lastScanReport = {
                date: new Date().toISOString(),
                score: score,
                items: items,
                userAgent: navigator.userAgent
            };

            // Show Export Buttons
            $('exportGroup').style.display = 'flex';
            
            btn.innerHTML = 'âœ… ×¡×¨×™×§×” ×”×•×©×œ××”';
            btn.disabled = false;
            log(`Scan finished. Score: ${score}`);
            
            // Auto expand cards with issues
            document.querySelectorAll('.card').forEach(c => {
                if(c.querySelector('.badge.bad') || c.querySelector('.badge.warn')) {
                    c.classList.add('expanded');
                }
            });
        }

        function renderResultItem(data) {
            const container = $(`list-${data.group}`);
            if (!container) return;

            const div = document.createElement('div');
            // Safe rendering using escapeHTML
            div.innerHTML = `
                <div class="list-item">
                    <span>${escapeHTML(data.title)}</span>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-family:monospace; font-size:11px; opacity:0.8;">${escapeHTML(String(data.result.val))}</span>
                        <span class="badge ${data.result.status}">${data.result.status}</span>
                    </div>
                </div>
                <div class="detail-row">
                    <div><strong>××©××¢×•×ª:</strong> ${escapeHTML(data.details.info)}</div>
                    <div style="margin-top:4px; color:var(--accent2);"><strong>×”××œ×¦×”:</strong> ${escapeHTML(data.details.fix)}</div>
                </div>
            `;
            container.appendChild(div);
        }

        // --- 5. Export Functions (JSON & HTML) ---

        function downloadJSON() {
            if (!lastScanReport) return alert('××™×Ÿ × ×ª×•× ×™× ×œ×”×•×¨×“×”');
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(lastScanReport, null, 2));
            const a = document.createElement('a');
            a.href = dataStr;
            a.download = `cyberscan_report_${Date.now()}.json`;
            a.click();
        }

        function downloadHTML() {
            if (!lastScanReport) return alert('××™×Ÿ × ×ª×•× ×™× ×œ×”×•×¨×“×”');
            
            // Generating a self-contained HTML report
            let itemsHtml = '';
            lastScanReport.items.forEach(item => {
                const color = item.result.status === 'good' ? '#2ea043' : (item.result.status === 'bad' ? '#f85149' : (item.result.status === 'warn' ? '#d29922' : '#1f6feb'));
                
                itemsHtml += `
                <div class="item" style="border-right: 4px solid ${color};">
                    <div class="header">
                        <strong>${escapeHTML(item.title)}</strong>
                        <span class="badge" style="background:${color}20; color:${color}">${item.result.status.toUpperCase()}</span>
                    </div>
                    <div class="value">×××¦×: ${escapeHTML(String(item.result.val))}</div>
                    <div class="desc">${escapeHTML(item.details.info)}</div>
                    <div class="fix">ğŸ’¡ ×ª×™×§×•×Ÿ: ${escapeHTML(item.details.fix)}</div>
                </div>`;
            });

            const htmlContent = `
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>CyberScan Report</title>
    <style>
        body { font-family: sans-serif; background: #f4f6f8; padding: 40px; color: #333; max-width: 800px; margin: 0 auto; }
        h1 { color: #d33b3b; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .summary { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .score { font-size: 24px; font-weight: bold; color: ${lastScanReport.score > 80 ? 'green' : 'red'}; }
        .disclaimer { background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; font-size: 13px; margin-bottom: 20px; }
        .item { background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .value { font-family: monospace; background: #f0f0f0; padding: 2px 5px; display: inline-block; border-radius: 3px; font-size: 12px; margin-bottom: 5px; }
        .desc { font-size: 13px; color: #555; }
        .fix { font-size: 13px; font-weight: bold; margin-top: 5px; color: #0366d6; }
        .badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>×“×•×— ×¡×¨×™×§×ª ×¦×“-×œ×§×•×—</h1>
    <div class="disclaimer">
        <strong>âš ï¸ ×”×¢×¨×” ×—×©×•×‘×”:</strong> ×‘×“×™×§×•×ª ××œ×• ×‘×•×¦×¢×• ×‘×¨××ª ×”×“×¤×“×¤×Ÿ (Client-Side) ×‘×œ×‘×“. ×”×’×“×¨×•×ª ×©×¨×ª ×¤× ×™××™×•×ª (×›×’×•×Ÿ HttpOnly Cookies, HSTS) ××™× ×Ÿ × ×™×ª× ×•×ª ×œ××™××•×ª ××œ× ×‘×“×¨×š ×–×• ×•×™×™×ª×›×Ÿ ×©×”×Ÿ ××•×’×“×¨×•×ª ×›×¨××•×™ ×‘×©×¨×ª ×œ××¨×•×ª ×©××™× ×Ÿ ××•×¤×™×¢×•×ª ×›××Ÿ.
    </div>
    <div class="summary">
        <div>×ª××¨×™×š: ${new Date().toLocaleString()}</div>
        <div>×¦×™×•×Ÿ ××©×•×§×œ×œ: <span class="score">${lastScanReport.score}/100</span></div>
    </div>
    <div class="results">
        ${itemsHtml}
    </div>
</body>
</html>`;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cyberscan_report_hebrew.html`;
            a.click();
        }

        // --- 6. Drag & Drop Logic (Restored) ---
        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.card');
            const container = document.querySelector('.results-grid');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => {
                    draggable.classList.add('dragging');
                });
                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                });
            });

            container.addEventListener('dragover', e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientY);
                const draggable = document.querySelector('.dragging');
                if (afterElement == null) {
                    container.appendChild(draggable);
                } else {
                    container.insertBefore(draggable, afterElement);
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // --- 7. Init ---
        
        $('startScanBtn').addEventListener('click', runScan);
        $('downloadJsonBtn').addEventListener('click', downloadJSON);
        $('downloadHebBtn').addEventListener('click', downloadHTML);
        
        // Theme Toggle
        $('themeToggle').addEventListener('click', () => {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', isDark ? 'light' : 'dark');
        });

        // Initialize UI
        initUI();

    </script>
</body>
</html>
