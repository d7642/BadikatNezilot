<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CyberScan Pro â€” Web Privacy Check</title>

  <!-- ×××§×¨×•-×¡×˜×™×™×œ ×›×”×”, ××§×¦×•×¢×™ ×•××“×•×™×§ ×œ××•×‘×™×™×œ -->
  <style>
    /* ... (CSS × ×©××¨ ×œ×œ× ×©×™× ×•×™, ××•××œ×¥ ×œ×”×¢×‘×™×¨ ×œ×§×•×‘×¥ ×—×™×¦×•× ×™) ... */
    :root{
      --bg:#060709;
      --panel:#0f1216;
      --muted:#98a2ad;
      --accent:#d33b3b;
      --accent2:#1f6feb;
      --good:#39b54a;
      --warn:#ffb86b;
      --bad:#ff5c5c;
      --glass: rgba(255,255,255,0.03);
      --gap:6px;
      font-family: "Segoe UI","Helvetica Neue",Arial,system-ui;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#050506 0%, var(--bg) 100%);color:#e6eef6}
    .app{max-width:920px;margin:10px auto;padding:10px}
    header{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7b1515);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:16px}
    .brand h1{font-size:18px;margin:0}
    .brand p{margin:0;font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:linear-gradient(90deg,var(--accent),#b72626);border:0;padding:12px 18px;border-radius:12px;color:white;font-weight:800;box-shadow:0 10px 32px rgba(0,0,0,0.6);display:inline-flex;align-items:center;gap:8px}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;font-weight:700}
    .score{display:flex;align-items:center;gap:10px}
    .score .val{font-size:20px;font-weight:900}
    .results{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),var(--panel));border-radius:12px;padding:10px 12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);display:flex;flex-direction:column;gap:6px}
    .card .head{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .card .title{font-weight:800;font-size:14px}
    .card .desc{font-size:12px;color:var(--muted);margin-top:0}
    .brief{font-size:13px;color:var(--muted)}
    .toggle{display:flex;align-items:center;gap:8px;cursor:pointer}
    .chev{transform:rotate(0deg);transition:transform .18s}
    .expanded .chev{transform:rotate(-90deg)}
    .details{overflow:hidden;max-height:0;transition:max-height .28s ease;padding-top:0}
    .expanded .details{max-height:900px;padding-top:8px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .badge{font-size:12px;padding:6px 8px;border-radius:8px;font-weight:700}
    .badge.good{background:rgba(57,181,74,0.12);color:var(--good)}
    .badge.warn{background:rgba(255,165,0,0.12);color:var(--warn)}
    .badge.bad{background:rgba(211,59,59,0.12);color:var(--bad)}
    .badge.neutral{background:rgba(255,255,255,0.02);color:var(--muted)}
    .list{display:flex;flex-direction:column;gap:6px}
    .line{display:flex;justify-content:space-between;gap:8px;font-size:13px}
    .muted{color:var(--muted);font-size:12px}
    .recommend{display:flex;flex-direction:column;gap:6px;margin-top:6px}
    .rec-item{display:flex;gap:8px;align-items:flex-start}
    .rec-item .dot{width:9px;height:9px;border-radius:50%;margin-top:6px}
    .rec-item .dot.good{background:var(--good)}
    .rec-item .dot.bad{background:var(--bad)}
    .rec-item .txt{font-size:13px}
    footer{margin-top:10px;font-size:12px;color:var(--muted);text-align:center}

    /* contact area compact */
    .contact{display:flex;gap:8px;align-items:center}
    .contact .email-text{font-size:13px;color:var(--muted)}
    .contact .icon{width:38px;height:38px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer}

    /* compact form */
    .contact-form{display:flex;flex-direction:column;gap:8px}
    .contact-form input, .contact-form textarea{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:inherit}
    .contact-form .row{display:flex;gap:8px}
    .muted-small{font-size:12px;color:var(--muted)}

    @media (max-width:520px){
      header{align-items:flex-start}
      .brand h1{font-size:16px}
      .logo{width:48px;height:48px}
      .btn{padding:10px 12px}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-live="polite">
    <header>
      <div class="brand" aria-hidden="false">
        <div class="logo">CSP</div>
        <div>
          <h1>CyberScan Pro</h1>
          <p>×‘×“×™×§×•×ª ×¤×¨×˜×™×•×ª ×•×× ×•× ×™××™×•×ª â€” ××•×ª×× ××•×‘×™×™×œ</p>
        </div>
      </div>

      <div class="controls">
        <div class="score" title="Privacy Score">
          <div class="val" id="privacyScore">â€”</div>
          <div class="muted-small">×¦×™×•×Ÿ ×¤×¨×˜×™×•×ª</div>
        </div>
        <button id="quickBtn" class="btn" aria-label="×‘×“×™×§×” ×§×¦×¨×”">ğŸ” ×‘×“×™×§×” ×§×¦×¨×”</button>
        <button id="fullBtn" class="btn secondary" aria-label="×‘×“×™×§×” ×œ××•××—×”">×‘×“×™×§×” ×œ××•××—×”</button>
      </div>
    </header>

    <div class="results" id="results">
      <div class="card" id="statusCard">
        <div class="head">
          <div>
            <div class="title">××¦×‘ ×¨××©×™</div>
            <div class="desc">×œ×—×¥ ×¢×œ "×‘×“×™×§×” ×§×¦×¨×”" â€” ×”×ª×•×¦××•×ª ×™×•×¤×™×¢×• ×›××Ÿ. ×›×œ ×”×‘×“×™×§×•×ª ×”×Ÿ ×‘×¦×“ ×”×œ×§×•×— ×‘×œ×‘×“.</div>
          </div>
          <div class="brief" id="statusBrief">××•×›×Ÿ</div>
        </div>
      </div>

      <!-- ×”×¨×‘×” ×—×œ×§×™×/×‘×“×™×§×•×ª (×”×›×œ Expandable) -->
      <div class="card section" id="publicIpCard">
        <div class="head toggle" data-target="publicIpCard">
          <div>
            <div class="title">IP ×¦×™×‘×•×¨×™</div>
            <div class="desc muted">×›×ª×•×‘×ª ×©××–×”×” ××ª ×”×”×ª×§×Ÿ ×‘××™× ×˜×¨× ×˜</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="publicIpBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="publicIpList"></div>
          <div class="recommend" id="publicIpRec"></div>
        </div>
      </div>

      <div class="card section" id="webrtcCard">
        <div class="head toggle" data-target="webrtcCard">
          <div>
            <div class="title">WebRTC / ×›×ª×•×‘×•×ª ××§×•××™×•×ª (ICE)</div>
            <div class="desc muted">×“×œ×™×¤×•×ª ×“×¨×š WebRTC â€” ×›×•×œ×œ IPv6</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="webrtcBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="webrtcList"></div>
          <div class="recommend" id="webrtcRec"></div>
        </div>
      </div>

      <div class="card section" id="dnsCard">
        <div class="head toggle" data-target="dnsCard">
          <div>
            <div class="title">×“×œ×™×¤×ª DNS</div>
            <div class="desc muted">× ×¡×” ×œ×–×”×•×ª ×©×¨×ª×™ DNS â€” ×‘×“×™×§×” ×—×œ×§×™×ª ×‘×œ×‘×“</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="dnsBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="dnsList"></div>
          <div class="recommend" id="dnsRec"></div>
        </div>
      </div>

      <div class="card section" id="fingerprintCard">
        <div class="head toggle" data-target="fingerprintCard">
          <div>
            <div class="title">Fingerprinting & Uniqueness</div>
            <div class="desc muted">× ××“×•×“ ×¢×“ ×›××” ×”×”×ª×§×Ÿ × ×™×™×— ×œ××¢×§×‘</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="fingerprintBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="fingerprintList"></div>
          <div class="recommend" id="fingerprintRec"></div>
        </div>
      </div>

      <div class="card section" id="cookiesCard">
        <div class="head toggle" data-target="cookiesCard">
          <div>
            <div class="title">Cookies & Tracking</div>
            <div class="desc muted">×¢×•×’×™×•×ª, localStorage ×•×¢×•×“</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="cookiesBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="cookiesList"></div>
          <div class="recommend" id="cookiesRec"></div>
        </div>
      </div>

      <div class="card section" id="browserCard">
        <div class="head toggle" data-target="browserCard">
          <div>
            <div class="title">××™×“×¢ ×“×¤×“×¤×Ÿ & ××¢×¨×›×ª</div>
            <div class="desc muted">UserAgent, ×©×¤×•×ª, screen ×•×‘×™×¦×•×¢×™×</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="browserBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="browserList"></div>
          <div class="recommend" id="browserRec"></div>
        </div>
      </div>

      <div class="card section" id="wifiCard">
        <div class="head toggle" data-target="wifiCard">
          <div>
            <div class="title">Wi-Fi / ×—×™×‘×•×¨ ×¨×©×ª</div>
            <div class="desc muted">type, effectiveType, downlink â€” ××•×’×‘×œ ×‘×“×¤×“×¤×Ÿ</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="wifiBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="wifiList"></div>
          <div class="recommend" id="wifiRec"></div>
        </div>
      </div>

      <div class="card section" id="portsCard">
        <div class="head toggle" data-target="portsCard">
          <div>
            <div class="title">×¡×§×™×¨×ª ×¤×•×¨×˜×™× (××•×’×‘×œ×ª)</div>
            <div class="desc muted">× ×™×¡×™×•× ×•×ª ×—×™×‘×•×¨ ×‘×“×¤×“×¤×Ÿ â€” ×œ× ×—×•×“×¨× ×™</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="portsBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="portsList"></div>
          <div class="recommend" id="portsRec"></div>
        </div>
      </div>

      <div class="card section" id="tlsCard">
        <div class="head toggle" data-target="tlsCard">
          <div>
            <div class="title">TLS / HTTPS Checks</div>
            <div class="desc muted">×‘×“×™×§×•×ª ×‘×¡×™×¡×™×•×ª ×œ×’×‘×™ ×©×™××•×© ×‘-HTTPS</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="tlsBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="tlsList"></div>
          <div class="recommend" id="tlsRec"></div>
        </div>
      </div>

      <div class="card section" id="extrasCard">
        <div class="head toggle" data-target="extrasCard">
          <div>
            <div class="title">×‘×“×™×§×•×ª × ×•×¡×¤×•×ª (Passive)</div>
            <div class="desc muted">Battery, Screen, Timezone, Permissions ×•×¢×•×“</div>
          </div>
          <div class="row">
            <div class="badge neutral" id="extrasBadge">×œ× × ×‘×“×§</div>
            <div class="chev">â€º</div>
          </div>
        </div>
        <div class="details">
          <div class="list" id="extrasList"></div>
          <div class="recommend" id="extrasRec"></div>
        </div>
      </div>

      <!-- Contact area: icon (opens mail) + compact form (mailto fallback) -->
      <div class="card" id="contactCard" aria-live="polite">
        <div class="head" style="align-items:center;">
          <div>
            <div class="title">×™×¦×™×¨×ª ×§×©×¨</div>
            <div class="desc muted">×”×•×“×¢×•×ª ×™×•×¤× ×• ×œ×›×ª×•×‘×ª ×©×”×’×“×¨×ª â€” ××¦×•×¨×£ ×’× ×˜×•×¤×¡ ×œ×©×œ×™×—×” ××”×™×¨×”.</div>
          </div>
          <div class="row">
            <div class="contact">
              <!-- ×”×˜×§×¡×˜ ×”×•×•×™×–×•××œ×™ × ×©××¨ ×‘-HTML -->
              <div class="icon" id="mailIcon" title="×©×œ×— ××™××™×™×œ">âœ‰ï¸</div>
              <div class="email-text" id="emailText">hacker[dot]david[at]gmail[dot]com</div>
            </div>
            <div class="muted-small">××• ×©×œ×— ×“×¨×š ×”×˜×•×¤×¡</div>
          </div>
        </div>

        <div class="details" style="max-height:400px;padding-top:6px;">
          <form id="contactForm" class="contact-form" onsubmit="return handleContactSubmit(event)">
            <input id="cf_name" placeholder="×©×" required />
            <input id="cf_subject" placeholder="× ×•×©×" required />
            <textarea id="cf_message" placeholder="×”×•×“×¢×”" rows="4" required></textarea>
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
              <div class="muted-small">×”×•×“×¢×” ×ª×™×¤×ª×— ×‘×ª×•×›× ×ª ×”×“×•××¨ ×©×œ×šâ€”×œ× × ×©×œ×—×ª ×œ×©×¨×ª</div>
              <button class="btn" type="submit">×©×œ×— ×”×•×“×¢×”</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="muted-small">×§×™×©×•×¨×™× ××”×™×¨×™×: <a href="/privacy.html" style="color:var(--muted)">××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª</a> â€¢ <a href="/tos.html" style="color:var(--muted)">×ª× ××™ ×©×™××•×©</a></div>
      </div>

    </div>

    <footer>Â© CyberScan Pro â€” ×›×œ ×”×‘×“×™×§×•×ª ×¤×¡×™×‘×™×•×ª ×‘×¦×“ ×”×œ×§×•×—. ××™×Ÿ ×©×™××•×© ×‘×¡×¨×™×§×•×ª ×¤×œ×™×œ×™×•×ª.</footer>
  </div>

  <script>
    // === CONFIG ===
    // ×›×ª×•×‘×ª ×”××™×™×œ ××•×¡×•×•×™×ª ×‘×ª×•×š ×”-JS ×›×“×™ ×œ×”×§×©×•×ª ×¢×œ ×¡×¨×™×§×” ××•×˜×•××˜×™×ª.
    const CONTACT_EMAIL_OBFUSCATED = "Hacker[dot]david[at]gmail[dot]com";

    // === UI helpers ===
    const $ = id => document.getElementById(id);
    document.querySelectorAll('.toggle').forEach(t=>{
      t.addEventListener('click', ()=>{
        const parent = t.closest('.section');
        parent.classList.toggle('expanded');
      });
    });
    
    // ×¤×•× ×§×¦×™×” ×œ×‘× ×™×™×ª ×”××™×™×œ ×”××œ× ××ª×•×š ×”××—×¨×•×–×ª ×”××•×¦×¤× ×ª
    function resolveEmail(obfuscatedEmail) {
        return obfuscatedEmail.replace(/\[dot\]/g, '.').replace(/\[at\]/g, '@');
    }

    // mail icon: on click, open mail client with prefilled subject
    $('mailIcon').addEventListener('click', ()=>{
      const realEmail = resolveEmail(CONTACT_EMAIL_OBFUSCATED);
      const mailto = buildMailTo(realEmail, "×¤× ×™×” ×-CyberScan Pro", "×©×œ×•×,\n\n");
      window.location.href = mailto;
    });

    // contact form: build mailto and open client
    function handleContactSubmit(e){
      e.preventDefault();
      const realEmail = resolveEmail(CONTACT_EMAIL_OBFUSCATED);
      const name = $('cf_name').value.trim();
      const subj = $('cf_subject').value.trim();
      const msg = $('cf_message').value.trim();
      const body = `×©×: ${name}\n\n${msg}\n\n---\n× ×©×œ×— ×-CyberScan Pro`;
      const mailto = buildMailTo(realEmail, subj || "×¤× ×™×” ×-CyberScan Pro", body);
      // open user's mail client (works on most devices)
      window.location.href = mailto;
      return false;
    }

    function buildMailTo(email, subject, body){
      // encode and return mailto: link
      return `mailto:${encodeURIComponent(email)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    // show obfuscated email visually (already in HTML - ×¨×§ ×× ×”-HTML ××™× ×• ××¢×•×“×›×Ÿ)
    // ×× ×”××©×ª××© ×©×œ×š ×©×™× ×” ××ª ×”×›×ª×•×‘×ª ×‘-HTML, × ×©×ª××© ×‘×”. ×× ×œ×, ×–×• ×“×•×’××” ×œ×©×™××•×© ×‘×”×¦×¤× ×”.
    // ×”×§×•×“ ×”××§×•×¨×™ ×”×©×ª××© ×‘×¤×•× ×§×¦×™×” ×”×–×•, × ×©××•×¨ ×¢×œ×™×” ×œ××§×¨×” ×©×”××©×ª××© ×©×•×œ×— ××™×™×œ ××•×¦×¤×Ÿ ××—×¨
    function obfuscateEmail(e){
      return e.replace(/@/,'[at]').replace(/\./g,'[dot]');
    }

    function setBadge(id, text, cls){
      const el = $(id);
      if(!el) return;
      el.textContent = text;
      // × ×©×ª××© ×‘-classList.remove/add ×‘××§×•× ×”×—×œ×¤×” ××œ××” ×›×“×™ ×œ×”×™×•×ª ×¢××™×“ ×™×•×ª×¨
      if(el.classList){
        el.className = 'badge'; // ××™×¤×•×¡
        el.classList.add(cls || 'neutral');
      } else {
        el.className = 'badge ' + (cls || 'neutral');
      }
      el.textContent = text;
    }

    /* ********** ×ª×™×§×•×Ÿ ××‘×˜×—×” ×§×¨×™×˜×™: ×©×™××•×© ×‘-textContent ×‘××§×•× .insertAdjacentHTML ********** */
    function appendList(id, key, value){
      const el = $(id);
      if(!el) return;

      // ×™×¦×™×¨×ª ××œ×× ×˜×™× ×‘××•×¤×Ÿ ×‘×˜×•×— ×•×©×™××•×© ×‘-textContent
      const line = document.createElement('div');
      line.className = 'line';

      const keyDiv = document.createElement('div');
      keyDiv.textContent = key;
      line.appendChild(keyDiv);

      const valueDiv = document.createElement('div');
      // × ×©×ª××© ×‘-strong ×¨×§ ×× ×”×¢×¨×š ×”×•× IP ××• × ×ª×•×Ÿ ××¤×ª×—, ××—×¨×ª × × ×™×— ×©×”×•× ×˜×§×¡×˜ ×¨×’×™×œ
      if(key.includes('IP') || key.includes('version')){
        const strong = document.createElement('strong');
        strong.textContent = String(value);
        valueDiv.appendChild(strong);
      } else if (key.includes('××“×™× ×™×•×ª')) {
        // ×× ×–×” ×˜×§×¡×˜ ×©×¦×¨×™×š ×œ×”×™×•×ª ××•×“×’×© ×›×”×¢×¨×”. ×¢×“×™×£ ×œ×§×‘×œ ××•×‘×™×™×§×˜ ×¢× ×ª×›×•× ×•×ª.
        valueDiv.className = key.includes('muted') ? 'muted' : '';
        valueDiv.textContent = String(value);
      } else {
         valueDiv.textContent = String(value);
      }

      el.appendChild(line);
    }
    /* ********** ×¡×•×£ ×ª×™×§×•×Ÿ ××‘×˜×—×” ×§×¨×™×˜×™ ********** */

    function clearAll(){
      ['publicIpList','webrtcList','dnsList','fingerprintList','cookiesList','browserList','wifiList','portsList','tlsList','extrasList'].forEach(id=>{ const el=$(id); if(el) el.innerHTML='';});
      ['publicIpBadge','webrtcBadge','dnsBadge','fingerprintBadge','cookiesBadge','browserBadge','wifiBadge','portsBadge','tlsBadge','extrasBadge'].forEach(b=>setBadge(b,'×œ× × ×‘×“×§','neutral'));
      $('privacyScore').textContent = 'â€”';
    }

    // === Basic scan runner (stage 1, passive & client-side only) ===
    $('quickBtn').addEventListener('click', ()=>runScan({extended:false}));
    $('fullBtn').addEventListener('click', ()=>runScan({extended:true}));

    async function runScan({extended=false}){
      clearAll();
      $('statusBrief').textContent = '×‘×•×“×§...';
      let score = 100;
      
      // 1) public IP
      try{
        const resp = await fetch('https://api.ipify.org?format=json');
        if(resp.ok){
          const j = await resp.json();
          appendList('publicIpList', 'IP ×—×™×¦×•× ×™', j.ip);
          setBadge('publicIpBadge','× ××¦×','good');
        }else throw new Error("API call failed");
      }catch(e){
        appendList('publicIpList', 'IP ×—×™×¦×•× ×™', '×œ× ×–××™×Ÿ (CORS/×—×¡×™××”)');
        setBadge('publicIpBadge','×œ× ×–××™×Ÿ','warn');
        score -= 5;
      }

      // 2) WebRTC ICE
      try{
        const ips = await gatherICE();
        if(ips.length===0){
          appendList('webrtcList', '××•×¢××“×™×', '×œ× × ××¦××• (×™×™×ª×›×Ÿ ×©×”×“×¤×“×¤×Ÿ ×—×•×¡×)');
          setBadge('webrtcBadge','×œ× × ××¦×','good');
        } else {
          ips.forEach(it=>appendList('webrtcList', it.type, it.ip));
          setBadge('webrtcBadge','× ××¦×','bad');
          score -= 25;
        }
      }catch(e){ appendList('webrtcList', '×©×’×™××”', String(e).slice(0,120)); setBadge('webrtcBadge','×©×’×™××”','warn'); score -= 10; }

      // 3) DNS (Cloudflare trace best-effort)
      try{
        const r = await fetch('https://cloudflare.com/cdn-cgi/trace');
        if(r.ok){
          const text = await r.text();
          const lines = text.split('\n').slice(0,10).map(l=>l.trim()).filter(Boolean);
          // ×›××Ÿ ×”×¦×’×ª ×”×˜×§×¡×˜ ×›-HTML × ×©××¨×” ×›×™ ×”×˜×§×¡×˜ ××’×™×¢ ×××§×•×¨ ×××™×Ÿ (Cloudflare) ×•××™× ×• ××›×™×œ ×§×œ×˜ ××©×ª××©
          // × ×™×ª×Ÿ ×œ×”×©×ª××© ×‘-appendList ×—×“×© ×©××§×‘×œ HTML
          const dnsListEl = $('dnsList');
          if(dnsListEl) dnsListEl.insertAdjacentHTML('beforeend', `<div class="muted">${lines.join(' â€¢ ')}</div>`);
          setBadge('dnsBadge','× ×‘×“×§','neutral');
        } else throw new Error("CF not reachable");
      }catch(e){ appendList('dnsList', '×œ× × ×‘×“×§ (CF)', '××™×Ÿ ×’×™×©×” ×œ-Cloudflare'); setBadge('dnsBadge','×œ× ×–××™×Ÿ','warn'); score -= 3; }

      // 4) Fingerprint (simple)
      try{
        const fp = {
          'User Agent':navigator.userAgent||'?',
          '×©×¤×”':navigator.language||navigator.languages?.[0]||'?',
          '×¤×œ×˜×¤×•×¨××”':navigator.platform||'?',
          '×¨×–×•×œ×•×¦×™×”':`${screen.width}x${screen.height}`,
          '××–×•×¨ ×–××Ÿ':Intl.DateTimeFormat().resolvedOptions().timeZone||'?',
        };
        Object.entries(fp).forEach(([k,v])=>appendList('fingerprintList', k, v));
        setBadge('fingerprintBadge','× ×‘×“×§','warn');
        if(fp['User Agent'] && fp['User Agent'].length>120) score -= 5;
      }catch(e){ setBadge('fingerprintBadge','×©×’×™××”','warn'); score -= 5; }

      // 5) cookies
      try{
        const cookieStr = document.cookie || '';
        const keys = cookieStr.split(';').map(s=>s.trim()).filter(Boolean);
        appendList('cookiesList', '×¢×•×’×™×•×ª ×§×™×™××•×ª (Cookies)', keys.length);
        setBadge('cookiesBadge','× ×‘×“×§','neutral');
        if(keys.length>5) score -= 6;
      }catch(e){ setBadge('cookiesBadge','×©×’×™××”','warn'); score -= 2; }

      // 6) browser info
      try{
        appendList('browserList', 'UserAgent', navigator.userAgent);
        appendList('browserList', '×©×¤×•×ª', (navigator.languages||[]).join(',')||navigator.language||'?');
        setBadge('browserBadge','× ×‘×“×§','neutral');
      }catch(e){ setBadge('browserBadge','×©×’×™××”','warn'); }

      // 7) location (no permission asked)
      // ×”×‘×“×™×§×” ×©×œ×š ×”×™×™×ª×” ×‘×ª×•×š ×”×œ×•×œ××”, ×©×™× ×™×ª×™ ×œ××™×§×•× ×©×•× ×” ××ª×•×š ×”× ×—×” ×©×™×© ×›×¨×˜×™×¡ × ×¤×¨×“ ×œ-Location
      // ×‘×’×œ×œ ×©××™×Ÿ ×›×¨×˜×™×¡ locationCard, ×”×©××¨×ª×™ ××ª ×”×§×•×“ ××—×•×¥ ×œ××‘× ×” ×”×‘×“×™×§×•×ª ×”××§×•×‘×œ - × ×“×¨×© ×©×™×¤×•×¨ UI
      try{
        const locationList = $('locationList'); // ×¦×¤×•×™ ×œ×”×™×›×©×œ ×›×™ ID ×œ× ×§×™×™×
        if('geolocation' in navigator){
          appendList('extrasList', 'Geolocation API', '×–××™×Ÿ (×œ× × ×‘×“×§)');
        } else {
          appendList('extrasList', 'Geolocation API', '×œ× × ×ª××š');
        }
        // ××™×Ÿ Badge ×œ××¢×œ×”, × ×ª×¢×œ× ××”-setBadege ×‘×‘×“×™×§×” ×–×•
      }catch(e){ /* noop */ }

      // 8) connection info
      try{
        const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection || null;
        if(conn){
          appendList('wifiList', 'type', conn.type||'?');
          appendList('wifiList', 'effectiveType', conn.effectiveType||'?');
          appendList('wifiList', 'downlink', conn.downlink||'?');
          setBadge('wifiBadge','× ×‘×“×§','neutral');
        } else {
          appendList('wifiList', 'Network Info API', '×œ× × ×ª××š');
          setBadge('wifiBadge','××•×’×‘×œ','warn');
        }
      }catch(e){ setBadge('wifiBadge','×©×’×™××”','warn'); }

      // 9) ports (safe attempts)
      try{
        const common=[80,443,8080,8443];
        const portResults=[];
        // ×©×™××•×© ×‘-Promise.all ×œ×¡×¨×™×§×” ××§×‘×™×œ×™×ª
        await Promise.all(common.map(async p=>{
          try{ await fetch(`http://127.0.0.1:${p}/`,{method:'GET',mode:'no-cors'}); portResults.push({port:p,open:true}); }
          catch(e){ portResults.push({port:p,open:false}); }
        }));
        
        // ×¡×™×“×•×¨ ×”×ª×•×¦××•×ª
        portResults.sort((a,b)=>a.port-b.port).forEach(r=>appendList('portsList', `×¤×•×¨×˜ ${r.port}`, (r.open? '××•×©×’':'×œ× ××•×©×’')));
        setBadge('portsBadge','× ×‘×“×§','neutral');
      }catch(e){ setBadge('portsBadge','×©×’×™××”','warn'); score -= 2; }

      // 10) TLS / HTTPS (basic)
      try{
        const isHttps = location.protocol === 'https:';
        appendList('tlsList', 'HTTPS ×‘××¢×¨×›×ª', isHttps? '×¤×•×¢×œ':'×œ× ×¤×¢×™×œ');
        setBadge('tlsBadge', isHttps? '×‘×˜×•×—':'×œ× ×‘×˜×•×—', isHttps? 'good':'bad');
        if(!isHttps) score -= 30;
      }catch(e){ setBadge('tlsBadge','×©×’×™××”','warn'); score -= 5; }

      // extras: battery, screen
      try{
        if(navigator.getBattery){ 
          const bat = await navigator.getBattery(); 
          appendList('extrasList', 'Battery Level', `${Math.round(bat.level*100)}%`);
        } else { 
          appendList('extrasList', 'Battery API', '×œ× × ×ª××š'); 
        }
        appendList('extrasList', 'Screen Dims', `${screen.width}x${screen.height} @ ${screen.colorDepth}bit`);
        appendList('extrasList', 'Timezone', Intl.DateTimeFormat().resolvedOptions().timeZone||'?');
        setBadge('extrasBadge','× ×‘×“×§','neutral');
      }catch(e){ setBadge('extrasBadge','×©×’×™××”','warn'); }


      // Final cleanup
      if(score < 0) score = 0;
      if(score > 100) score = 100;
      $('privacyScore').textContent = score;

      const scEl = $('privacyScore');
      scEl.style.color = score > 75 ? 'var(--good)' : (score>45 ? 'var(--warn)' : 'var(--bad)');
      $('statusBrief').textContent = '×”×•×©×œ×';

    }

    // gatherICE (same safe approach)
    function gatherICE(timeout=3500){
      return new Promise((resolve, reject)=>{
        const ips = new Map();
        let pc;
        try{
          pc = new RTCPeerConnection({iceServers:[{urls:['stun:stun.l.google.com:19302']}]});
          pc.createDataChannel('d');
          
          pc.onicecandidate = e=>{
            if(!e.candidate) return;
            const cand = e.candidate.candidate;
            const parts = cand.split(' ');
            // ×œ×•×œ××” ××©×•×¤×¨×ª ×•××“×•×™×§×ª ×™×•×ª×¨ ×œ×–×™×”×•×™ IP
            for(const p of parts){
              // ×‘×“×™×§×” ×”×× ×”××—×¨×•×–×ª ×”×™× IP
              if(p.match(/\b(?:\d{1,3}\.){3}\d{1,3}\b/) || p.includes(':')){
                // × ×™×§×•×™ ×¡×™×× ×™× ××™×•×ª×¨×™× ××¡×‘×™×‘ ×œ-IP ×œ×™×ª×¨ ×‘×™×˜×—×•×Ÿ
                const ip = p.replace(/[^0-9a-fA-F:\.]/g,'');
                if(!ip || ip.length < 7) continue;

                // ×§×‘×™×¢×ª ×¡×•×’ ×”-IP
                let type = 'other';
                if (cand.includes('typ srflx')) type = 'Public (STUN)';
                else if (cand.includes('typ host')) type = 'Local (Host)';
                else if (cand.includes('typ relay')) type = 'Relayed (TURN)';

                ips.set(ip, {ip,type});
              }
            }
          };
          pc.createOffer().then(offer=>pc.setLocalDescription(offer)).catch(()=>{/* noop */});
          
          // ×¡×’×™×¨×ª ×”×—×™×‘×•×¨ ×œ××—×¨ ×¤×¡×§ ×–××Ÿ
          setTimeout(()=>{ try{ pc.close(); }catch(e){}; resolve(Array.from(ips.values())); }, timeout);

        }catch(err){ 
            if(pc && pc.close) pc.close();
            resolve([]); 
        }
      });
    }

    // register a minimal service worker (PWA support) - will silently fail if not present
    if('serviceWorker' in navigator){
      // ××•××œ×¥ ×œ×”×•×¡×™×£ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×’× ×›××Ÿ ×œ-catch ×œ××¨×•×ª ×”-noop
      navigator.serviceWorker.register('/sw.js').catch(err=>{ console.warn('SW registration failed:', err); });
    }

    // On load â€” small hint if user wants to test
    window.addEventListener('load', ()=>{ /* ready */ });
  </script>
</body>
</html>